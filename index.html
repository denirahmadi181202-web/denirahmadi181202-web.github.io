<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Wedding of ZAIDY & ROHMA</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Fonts: Lora (Serif Elegan) & Inter (Sans-serif Modern) -->
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Load Lucide Icons for aesthetic elements -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- FIREBASE MODULES IMPORTS -->
    <script type="module">
        // Import modul Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, onSnapshot, collection, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Atur level log untuk melihat pesan debug Firestore
        setLogLevel('Debug');
        
        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Define global variables for use in the main script
        window.firebaseApp = initializeApp(firebaseConfig);
        window.db = getFirestore(window.firebaseApp);
        window.auth = getAuth(window.firebaseApp);
        window.serverTimestamp = serverTimestamp;

        // AUTHENTICATION & INITIALIZATION
        async function initializeFirebase() {
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(window.auth, initialAuthToken);
                } else {
                    await signInAnonymously(window.auth);
                }
            } catch (error) {
                console.error("Firebase Auth Error:", error);
            }

            // Once authentication state is known, proceed with Firestore listeners
            onAuthStateChanged(window.auth, (user) => {
                window.userId = user ? user.uid : crypto.randomUUID(); // Fallback for userId
                document.getElementById('user-id-display').textContent = `ID Sesi: ${window.userId}`;
                
                // Panggil fungsi yang membutuhkan inisialisasi Firebase/Auth
                window.setupFirestoreListeners(); 
            });
        }
        
        // Panggil inisialisasi saat script module dimuat
        initializeFirebase();

        // Expose necessary Firestore functions globally for the main script
        window.firestore = {
            doc, addDoc, onSnapshot, collection, query, serverTimestamp
        };
        // Aturan path sesuai dengan panduan: /artifacts/{appId}/public/data/{your_collection_name}
        window.COLLECTIONS = {
            UCAPAN: `artifacts/${appId}/public/data/ucapans`,
            RSVP: `artifacts/${appId}/public/data/rsvps`,
        };
    </script>

    <!-- Konfigurasi Tailwind untuk Warna dan Font Kustom -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        // Lora untuk kesan elegan dan minimalis (digunakan untuk judul)
                        display: ['Lora', 'serif'], 
                        // Inter untuk body teks (digunakan untuk konten)
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'navy-primary': '#0F172A', // Warna utama: Navy Blue (Slate-900)
                        'navy-light': '#1e3a8a', // Aksen Navy yang lebih terang (Blue-800)
                        'ivory-bg': '#F7F7F0', // Latar belakang yang lembut (Off-White/Ivory)
                        'gold-accent': '#C9B072', // Aksen sekunder: Emas lembut/Krem
                        'text-light': '#E5E7EB', // Teks terang untuk latar belakang gelap (Putih Off-White)
                    },
                }
            }
        }
    </script>
    <style>
        /* CSS Kustom untuk Minimalisme, Efek Scroll, dan Parallax */
        body {
            background-color: #F7F7F0; /* Latar belakang ivory lembut */
            color: #0F172A;
            overflow-x: hidden; 
        }

        /* Gaya Khusus Hero Section (Menggunakan Parallax/Fixed Background) */
        #hero-section {
            height: 100vh;
            /* Default background image placeholder/fallback, will be set by JS */
            background-image: linear-gradient(rgba(15, 23, 42, 0.6), rgba(15, 23, 42, 0.8)), var(--hero-image-url);
            background-size: cover;
            background-position: center;
            background-attachment: fixed; /* Efek Parallax Ringan */
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease-in-out;
        }

        /* Scroll Reveal (Animasi Awal) */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            /* Transisi Cubic Bezier untuk kesan elegan */
            transition: opacity 1.0s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 1.0s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Divider minimalis */
        .minimal-divider {
            width: 60px;
            height: 1px;
            background-color: #C9B072;
            margin: 1rem auto;
            opacity: 0.8;
        }
        
        /* Button Style */
        .primary-btn {
            @apply px-8 py-3 bg-gold-accent text-navy-primary font-semibold rounded-full shadow-lg transition duration-300 hover:bg-gold-accent/80 hover:shadow-xl flex items-center justify-center;
        }

        /* Card Style */
        .info-card {
             @apply p-6 md:p-10 bg-white rounded-xl shadow-xl border-t-4 border-gold-accent/80 transition duration-500 hover:shadow-2xl;
        }

        /* Scrollbar untuk List Ucapan */
        #ucapan-list::-webkit-scrollbar {
            width: 6px;
        }
        #ucapan-list::-webkit-scrollbar-thumb {
            background-color: #C9B072;
            border-radius: 10px;
        }
        #ucapan-list::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
    </style>
</head>
<body>

    <!-- Tombol Mute/Unmute Musik (Fixed) -->
    <button id="music-control" class="fixed bottom-4 right-4 z-50 p-3 bg-navy-primary text-text-light rounded-full shadow-xl transition-all duration-300 hover:scale-110">
        <!-- Ikon Mute (Default) -->
        <svg id="music-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 10v4c0 .55.45 1 1 1h3l5 5V5L7 1H4c-.55 0-1 .45-1 1v8zm14.39 5.86c.07.4-.2.83-.67.83h-.14c-.38 0-.75-.24-.9-.63C14.86 14.84 14 13.59 14 12c0-1.59.86-2.84 1.68-3.32.15-.39.52-.63.9-.63h.14c.47 0 .74.43.67.83-.55 3.09-.55 5.51 0 5.09zM19 12c0 2.82-1.38 5.37-3.5 7.15c-.24.2-.24.51 0 .71.25.21.64.21.89 0C18.66 17.51 20 14.88 20 12s-1.34-5.51-3.61-7.86c-.25-.21-.64-.21-.89 0-.24.2-.24.51 0 .71C17.62 6.63 19 9.18 19 12z" />
        </svg>
    </button>
    <audio id="background-music" loop></audio>


    <!-- HERO SECTION (Halaman Utama) -->
    <section id="hero-section" class="text-center p-4">
        <div class="bg-navy-primary/90 p-8 md:p-12 rounded-2xl shadow-2xl max-w-lg w-full reveal transition-all duration-1000">
            <p class="text-xl text-text-light font-sans mb-3 tracking-wider font-light">Kepada Yth. Bapak/Ibu/Saudara/i,</p>
            <!-- Teks Tamu Undangan berwarna putih sesuai permintaan -->
            <p id="guest-name" class="text-3xl font-display font-bold text-text-light mb-6">Tamu Undangan</p>

            <p class="text-lg text-text-light font-sans mb-3 tracking-wider font-light">The Wedding Of</p>
            <h1 class="text-7xl md:text-9xl font-display font-bold text-gold-accent my-4 leading-none transform transition duration-1000">
                Z <span class="text-text-light text-5xl md:text-6xl">&amp;</span> R
            </h1>
            <h2 class="text-2xl md:text-3xl font-display font-semibold text-text-light mt-4 mb-2">
                ZAIDY & ROHMA 
            </h2>
            <!-- Tanggal Sesuai Data: 2025-12-06 -->
            <p class="text-xl text-text-light font-sans font-medium">06 Desember 2025</p>
            
            <!-- Tombol Buka Undangan -->
            <button id="open-invitation-btn" 
                class="mt-8 px-8 py-3 bg-gold-accent text-white font-semibold rounded-full shadow-lg transition duration-300 hover:bg-gold-accent/80 hover:shadow-xl">
                 <i data-lucide="mail-open"></i> Buka Undangan
            </button>
            <p id="user-id-display" class="text-xs text-gray-500 mt-4 px-2"></p>
        </div>
    </section>
    
    <!-- Bagian Utama Konten (Disembunyikan sebelum interaksi user) -->
    <div id="main-content" class="hidden">

        <!-- KUTIPAN AL-QUR'AN (Kata-kata Pembuka) -->
        <section id="quote-section" class="py-16 md:py-24 px-4 bg-ivory-bg text-center">
            <div class="max-w-4xl mx-auto reveal">
                <h3 class="text-xl font-semibold text-navy-primary mb-6">Bismillahirrahmanirrahim</h3>
                <p class="text-xl md:text-2xl font-display italic text-gray-700 leading-relaxed">
                    ‚ÄúDan di antara tanda-tanda kekuasaan-Nya ialah Dia menciptakan untukmu isteri-isteri dari jenismu sendiri, supaya kamu cenderung dan merasa tenteram kepadanya, dan dijadikan-Nya di antaramu rasa kasih dan sayang.‚Äù
                </p>
                <p class="text-md font-semibold text-navy-primary mt-4">‚Äî Q.S. Ar-Rum (30) : 21</p>
            </div>
        </section>

        <!-- DETAIL PASANGAN -->
        <section id="detail-pasangan" class="py-16 md:py-24 px-4 bg-navy-primary text-text-light">
            <div class="max-w-4xl mx-auto text-center reveal">
                <h2 class="text-4xl font-display font-bold text-gold-accent mb-2">Mempelai</h2>
                <div class="minimal-divider"></div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10 mt-12">
                    <div class="reveal p-4">
                        <!-- Foto Pengantin Pria - Placeholder -->
                        <img src="https://placehold.co/150x150/C9B072/0F172A?text=AZ" onerror="this.onerror=null;this.src='https://placehold.co/150x150/C9B072/0F172A?text=AZ'" alt="Foto Pengantin Pria" class="w-40 h-40 mx-auto rounded-full object-cover mb-4 border-4 border-gold-accent/70 shadow-lg">
                        <h3 class="text-3xl font-display font-bold text-text-light">AHBAB ZAIDI</h3>
                        <p class="text-md text-gray-400 mt-2">Putra dari Bpk. AHMAD & Ibu. JUHADAH</p>
                        <p class="text-gold-accent font-display text-xl mt-3">ü§µ</p>
                    </div>
                    <div class="reveal p-4">
                        <!-- Foto Pengantin Wanita - Placeholder -->
                        <img src="https://placehold.co/150x150/C9B072/0F172A?text=RS" onerror="this.onerror=null;this.src='https://placehold.co/150x150/C9B072/0F172A?text=RS'" alt="Foto Pengantin Wanita" class="w-40 h-40 mx-auto rounded-full object-cover mb-4 border-4 border-gold-accent/70 shadow-lg">
                        <h3 class="text-3xl font-display font-bold text-text-light">ROHMA SEPTIANA</h3>
                        <p class="text-md text-gray-400 mt-2">Putri dari Bpk. SAHNAN & Ibu. SUHANEP (Alm)</p>
                        <p class="text-gold-accent font-display text-xl mt-3">üë∞</p>
                    </div>
                </div>
                
                <!-- Kisah Singkat Opsional -->
                <p class="mt-12 text-gray-400 italic text-base max-w-xl mx-auto">
                    "Cinta mempertemukan kami dalam sebuah takdir indah, yang disempurnakan dalam ikatan suci pernikahan."
                </p>
            </div>
        </section>

        <!-- COUNTDOWN TIMER -->
        <section id="countdown-timer" class="py-16 md:py-24 bg-ivory-bg text-center">
            <div class="max-w-4xl mx-auto px-4 reveal">
                <h2 class="text-4xl font-display font-bold text-navy-primary mb-2">Menghitung Hari</h2>
                <div class="minimal-divider"></div>
                <p class="text-lg text-gray-500 font-sans mb-8">Pernikahan akan diselenggarakan dalam:</p>
                <div id="countdown" class="flex justify-center space-x-3 md:space-x-6 text-navy-primary font-sans font-bold">
                    <!-- Countdown blocks will be inserted here by JS -->
                </div>
            </div>
        </section>

        <!-- INFORMASI ACARA -->
        <section id="acara-section" class="py-16 md:py-24 px-4 bg-navy-primary text-text-light">
            <div class="max-w-5xl mx-auto text-center">
                <h2 class="text-4xl font-display font-bold text-gold-accent mb-2 reveal">Waktu dan Lokasi</h2>
                <div class="minimal-divider reveal"></div>
                <p class="text-lg text-gray-400 mb-12 reveal">Kami mengundang Anda untuk hadir dalam rangkaian acara berikut:</p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <!-- AKAD NIKAH -->
                    <div class="info-card bg-text-light text-navy-primary reveal">
                        <h3 class="text-2xl font-display font-bold text-navy-light mb-4 flex items-center justify-center">
                            <i data-lucide="heart" class="w-5 h-5 mr-2"></i> Akad Nikah
                        </h3>
                        <p class="text-lg font-semibold text-gray-700">Jum'at, 06 Desember 2025</p>
                        <p class="text-4xl font-display font-extrabold text-gold-accent my-4">08:00 WITA</p>
                        <p class="mt-2 text-gray-600 font-medium">Lokasi:</p>
                        <!-- Lokasi Sesuai Data -->
                        <p class="text-base text-gray-500 italic px-2">di samping SDN 3 Mamben Daya, Kec. Wanasaba, Kab. Lombok Timur, NTB</p>
                        <a href="https://www.google.com/maps/search/?api=1&query=SDN+3+Mamben+Daya" target="_blank" class="inline-block mt-6 px-5 py-2 bg-navy-primary text-white rounded-full text-sm font-semibold hover:bg-navy-light transition flex items-center justify-center mx-auto max-w-fit">
                            <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i> Lihat Peta Lokasi
                        </a>
                    </div>

                    <!-- RESEPSI -->
                    <div class="info-card bg-text-light text-navy-primary reveal">
                        <h3 class="text-2xl font-display font-bold text-navy-light mb-4 flex items-center justify-center">
                            <i data-lucide="party-popper" class="w-5 h-5 mr-2"></i> Resepsi Pernikahan
                        </h3>
                        <p class="text-lg font-semibold text-gray-700">Jum'at, 06 Desember 2025</p>
                        <p class="text-4xl font-display font-extrabold text-gold-accent my-4">10:00 WITA - Selesai</p>
                        <p class="mt-2 text-gray-600 font-medium">Lokasi:</p>
                        <!-- Lokasi Sesuai Data -->
                        <p class="text-base text-gray-500 italic px-2">di samping SDN 3 Mamben Daya, Kec. Wanasaba, Kab. Lombok Timur, NTB</p>
                        <a href="https://www.google.com/maps/search/?api=1&query=SDN+3+Mamben+Daya" target="_blank" class="inline-block mt-6 px-5 py-2 bg-navy-primary text-white rounded-full text-sm font-semibold hover:bg-navy-light transition flex items-center justify-center mx-auto max-w-fit">
                            <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i> Lihat Peta Lokasi
                        </a>
                    </div>

                    <!-- Google Maps Embed (Fixed location based on data) -->
                    <div class="md:col-span-2 mt-8 reveal">
                        <!-- Menggunakan lokasi Lombok Timur sebagai placeholder koordinat -->
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3945.3995878438695!2d116.52044397486822!3d-8.583561389801948!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2dbe2c7515d9cccd%3A0x7d25e01c706d15a9!2sMamben%20Daya%2C%20Wanasaba%2C%20East%20Lombok%20Regency%2C%20West%20Nusa%20Tenggara!5e0!3m2!1sen!2sid!4v1700440000000" width="100%" height="350" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" class="rounded-xl shadow-2xl border-2 border-gold-accent"></iframe>
                    </div>

                </div>
            </div>
        </section>
        
        <!-- WEDDING GIFT SECTION -->
        <section id="gift-section" class="py-16 md:py-24 px-4 bg-ivory-bg text-center">
            <div class="max-w-xl mx-auto reveal info-card">
                <h2 class="text-3xl font-display font-bold text-navy-primary mb-2 flex items-center justify-center">
                    <i data-lucide="gift" class="w-6 h-6 mr-2"></i> Wedding Gift
                </h2>
                <div class="minimal-divider"></div>
                <p class="text-md text-gray-600 mb-6">Tanpa mengurangi rasa hormat, bagi yang ingin memberikan tanda kasih, dapat melalui rekening berikut:</p>
                
                <div class="p-4 bg-navy-primary text-text-light rounded-lg shadow-md">
                    <!-- Informasi Rekening Sesuai Data -->
                    <p class="text-sm text-gray-400 mb-1">BANK BRI (A.N. AHBAB ZAIDY)</p>
                    <div class="flex justify-center items-center space-x-3">
                        <span id="account-number" class="text-2xl font-bold font-mono tracking-wider text-gold-accent">
                            473401075561531
                        </span>
                        <button id="copy-btn" class="p-2 bg-gold-accent text-navy-primary rounded-lg transition hover:bg-gold-accent/80" title="Salin Nomor Rekening">
                            <i data-lucide="copy" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div id="copy-message" class="text-sm mt-2 text-green-300 hidden">Berhasil disalin!</div>
                </div>
            </div>
        </section>

        <!-- PHOTO GALLERY -->
        <section id="gallery-section" class="py-16 md:py-24 px-4 bg-navy-primary text-text-light">
            <div class="max-w-6xl mx-auto text-center">
                <h2 class="text-4xl font-display font-bold text-gold-accent mb-2 reveal">Galeri Foto</h2>
                <div class="minimal-divider reveal"></div>
                <p class="text-lg text-gray-400 mb-12 reveal">Perjalanan cinta Zaidy & Rohma</p>

                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                    <!-- Images Sesuai Data -->
                    <div class="rounded-xl overflow-hidden aspect-square reveal transition duration-500 hover:scale-[1.05] hover:shadow-2xl">
                        <img src="https://lh3.googleusercontent.com/d/1Uj4xOto30MWnBM6P1bFMPZBh7n4Vv_iG" onerror="this.onerror=null;this.src='https://placehold.co/500x500/0F172A/C9B072?text=Foto+1';" alt="Foto Pasangan 1" class="w-full h-full object-cover">
                    </div>
                    <div class="rounded-xl overflow-hidden aspect-square reveal transition duration-500 hover:scale-[1.05] hover:shadow-2xl">
                        <img src="https://lh3.googleusercontent.com/d/1ra0wj2bEvmUeVucUaqlmYrh6tXJM3fMt" onerror="this.onerror=null;this.src='https://placehold.co/500x500/C9B072/0F172A?text=Foto+2';" alt="Foto Pasangan 2" class="w-full h-full object-cover">
                    </div>
                    <div class="rounded-xl overflow-hidden aspect-square reveal transition duration-500 hover:scale-[1.05] hover:shadow-2xl">
                        <img src="https://lh3.googleusercontent.com/d/1H2wlG8QyZKA7RIgSo5y7sK0sx9rQmwjX" onerror="this.onerror=null;this.src='https://placehold.co/500x500/0F172A/C9B072?text=Foto+3';" alt="Foto Pasangan 3" class="w-full h-full object-cover">
                    </div>
                    <div class="rounded-xl overflow-hidden aspect-square reveal transition duration-500 hover:scale-[1.05] hover:shadow-2xl">
                        <img src="https://lh3.googleusercontent.com/d/1X8rYg-YV5ZvLRwl5ucHQGpzno88w9cck" onerror="this.onerror=null;this.src='https://placehold.co/500x500/C9B072/0F172A?text=Foto+4';" alt="Foto Pasangan 4" class="w-full h-full object-cover">
                    </div>
                </div>
            </div>
        </section>
        
        <!-- RSVP FORM & UCAPAN TAMU (Firestore Integrated) -->
        <section id="interaksi-section" class="py-16 md:py-24 px-4 bg-ivory-bg">
            <div class="max-w-3xl mx-auto">
                
                <!-- RSVP FORM (Firestore) -->
                <div id="rsvp-form-container" class="info-card mb-12 reveal">
                    <h2 class="text-3xl font-display font-bold text-navy-primary mb-4 text-center">Konfirmasi Kehadiran</h2>
                    <div class="minimal-divider"></div>
                    <p class="text-center text-sm text-gray-500 mb-4">Mohon isi untuk mengkonfirmasi kehadiran Anda. (Data akan disimpan)</p>
                    <form id="rsvp-form" class="space-y-4 mt-6">
                        <div>
                            <label for="rsvp-nama" class="block text-sm font-medium text-gray-700">Nama Tamu</label>
                            <input type="text" id="rsvp-nama" placeholder="Nama Anda" required class="w-full p-3 mt-1 border border-gray-300 rounded-lg focus:ring-gold-accent focus:border-gold-accent transition">
                        </div>
                        <div>
                            <label for="rsvp-hadir" class="block text-sm font-medium text-gray-700">Status Kehadiran</label>
                            <select id="rsvp-hadir" required class="w-full p-3 mt-1 border border-gray-300 rounded-lg focus:ring-gold-accent focus:border-gold-accent transition">
                                <option value="" disabled selected>Pilih Status</option>
                                <option value="hadir">Ya, saya akan hadir</option>
                                <option value="tidak">Maaf, saya tidak bisa hadir</option>
                            </select>
                        </div>
                        <button type="submit" class="w-full primary-btn mt-6">
                            Kirim Konfirmasi RSVP
                        </button>
                        <div id="rsvp-message" class="mt-4 p-3 rounded-lg text-center hidden font-semibold border transition duration-300"></div>
                    </form>
                </div>

                <!-- UCAPAN DARI TAMU (Firestore Real-time) -->
                <div id="ucapan-tamu-container" class="info-card reveal">
                    <h2 class="text-3xl font-display font-bold text-navy-primary mb-4 text-center">Doa dan Ucapan</h2>
                    <div class="minimal-divider"></div>
                    
                    <form id="ucapan-form" class="space-y-3">
                        <input type="text" id="ucapan-nama" placeholder="Nama Anda" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-gold-accent focus:border-gold-accent transition">
                        <textarea id="ucapan-text" rows="4" placeholder="Tulis ucapan selamat dan doa terbaik Anda di sini..." required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-gold-accent focus:border-gold-accent transition"></textarea>
                        <button type="submit" class="mt-4 w-full primary-btn bg-navy-primary text-text-light hover:bg-navy-light">
                            Kirim Ucapan
                        </button>
                        <div id="ucapan-message" class="mt-4 p-3 rounded-lg text-center hidden font-semibold border transition duration-300"></div>
                    </form>

                    <!-- Bagian Tampilan Ucapan (Real-time dari Firestore) -->
                    <div class="mt-8 pt-4 border-t border-gray-200">
                        <h3 class="text-xl font-semibold text-navy-primary mb-3 flex items-center">
                            <i data-lucide="message-square" class="w-5 h-5 mr-2 text-gold-accent"></i> Kiriman Ucapan
                        </h3>
                        <div id="ucapan-list" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                            <p class="text-center text-sm text-gray-500 loading-indicator">Memuat ucapan...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>


        <!-- PENUTUP/FOOTER -->
        <footer class="py-12 bg-navy-primary text-text-light text-center px-4">
            <div class="max-w-4xl mx-auto reveal">
                <h2 class="text-4xl font-display font-bold text-gold-accent mb-4">Terima Kasih</h2>
                <p class="text-gray-400 mb-6 text-lg">Kehadiran serta doa restu Anda merupakan hadiah terindah bagi kami.</p>
                <p class="text-2xl font-display font-bold text-text-light">&mdash; AHBAB ZAIDI & ROHMA SEPTIANA &mdash;</p>
                <p class="text-xs text-gray-600 mt-4"></p>
            </div>
        </footer>
    </div>


    <script>
        // --- DATA KONSTAN & SETUP ---
        // Tanggal Pernikahan Sesuai Data: 2025-12-06, Pukul 08:00 WITA
        const WEDDING_DATE = new Date('2025-12-06T08:00:00+08:00').getTime(); 
        // Hero Image Sesuai Data
        const HERO_IMAGE_LINK = 'https://lh3.googleusercontent.com/d/1TflvB7uUD821JPUcWzWVxsPC9Ry6QUgd'; 
        // Audio Link Sesuai Data
        const AUDIO_LINK = 'https://lh3.googleusercontent.com/d/1NpU5N-fcc4JOklqdwSjXzH37MEaV9U7j';
        
        const heroSection = document.getElementById('hero-section');
        const mainContent = document.getElementById('main-content');
        const audio = document.getElementById('background-music');
        const musicControlBtn = document.getElementById('music-control');
        const openBtn = document.getElementById('open-invitation-btn');
        let isPlaying = false;

        // --- FUNGSI UTILITY PESAN (Non-alert) ---
        function displayMessage(element, text, className) {
            element.innerHTML = text;
            element.className = `mt-4 p-3 rounded-lg text-center font-semibold border ${className}`;
            element.classList.remove('hidden');
            setTimeout(() => {
                element.classList.add('hidden');
            }, 5000); 
        }

        // --- FUNGSI IKON MUSIK ---
        function setMusicIcon(playing) {
            // Mengganti ikon antara volume (on) dan volume-x (mute)
            const iconSvg = playing 
                ? `<path d="M10 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1zM5 7a1 1 0 011 1v4a1 1 0 11-2 0V8a1 1 0 011-1zM15 7a1 1 0 011 1v4a1 1 0 11-2 0V8a1 1 0 011-1zM19 12c0 2.82-1.38 5.37-3.5 7.15c-.24.2-.24.51 0 .71.25.21.64.21.89 0C18.66 17.51 20 14.88 20 12s-1.34-5.51-3.61-7.86c-.25-.21-.64-.21-.89 0-.24.2-.24.51 0 .71C17.62 6.63 19 9.18 19 12z"/>`
                : `<path d="M3 10v4c0 .55.45 1 1 1h3l5 5V5L7 1H4c-.55 0-1 .45-1 1v8zm14.39 5.86c.07.4-.2.83-.67.83h-.14c-.38 0-.75-.24-.9-.63C14.86 14.84 14 13.59 14 12c0-1.59.86-2.84 1.68-3.32.15-.39.52-.63.9-.63h.14c.47 0 .74.43.67.83-.55 3.09-.55 5.51 0 5.09zM19 12c0 2.82-1.38 5.37-3.5 7.15c-.24.2-.24.51 0 .71.25.21.64.21.89 0C18.66 17.51 20 14.88 20 12s-1.34-5.51-3.61-7.86c-.25-.21-.64-.21-.89 0-.24.2-.24.51 0 .71C17.62 6.63 19 9.18 19 12zM17.61 14.87L19 16.26l-1.41 1.41-1.39-1.39c-.58.34-1.25.56-1.95.64l1.24 1.24L15 19.98l-2.73-2.73-2.73 2.73-1.41-1.41 2.73-2.73L8 15.65l-1.41-1.41 1.41-1.41L6.59 10L8 8.59l1.41 1.41L11 8.59l1.41 1.41L13.82 8l1.41 1.41-1.41 1.41L15.24 12l1.41 1.41-1.41 1.41z"/>`;
            
            document.getElementById('music-icon').innerHTML = iconSvg;
        }


        // --- Inisialisasi Hero Image dan Error Handling ---
        function setupHeroImage() {
            // Set style for background-image using CSS variable
            heroSection.style.setProperty('--hero-image-url', `url('${HERO_IMAGE_LINK}')`);

            const tempImg = new Image();
            tempImg.onerror = function() {
                console.warn("Hero Image gagal dimuat. Menggunakan background warna solid.");
                // Ganti gaya latar belakang jika gambar gagal
                heroSection.style.setProperty('--hero-image-url', 'none');
                heroSection.style.backgroundImage = 'linear-gradient(rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.9))';
                heroSection.style.backgroundAttachment = 'scroll';
            };
            tempImg.src = HERO_IMAGE_LINK; 
        }

        // --- FUNGSI COUNTDOWN TIMER ---
        function updateCountdown() {
            const now = new Date().getTime();
            const distance = WEDDING_DATE - now;
            const countdownEl = document.getElementById('countdown');

            // Hitung Waktu
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            if (distance < 0) {
                clearInterval(window.countdownInterval);
                countdownEl.innerHTML = `<p class="text-2xl text-gold-accent font-display">ACARA SEDANG/TELAH BERLANGSUNG</p>`;
                return;
            } 
            
            countdownEl.innerHTML = `
                ${createCountdownBlock(days, 'Hari')}
                ${createCountdownBlock(hours, 'Jam')}
                ${createCountdownBlock(minutes, 'Menit')}
                ${createCountdownBlock(seconds, 'Detik')}
            `;
        }

        function createCountdownBlock(value, label) {
            return `
                <div class="w-16 h-20 md:w-24 md:h-28 bg-navy-light/70 text-text-light rounded-xl shadow-lg flex flex-col justify-center items-center border-b-4 border-gold-accent transition duration-300 transform hover:scale-[1.03]">
                    <span class="text-2xl md:text-4xl font-bold">${value}</span>
                    <span class="text-xs md:text-sm font-normal">${label}</span>
                </div>
            `;
        }

        // --- FUNGSI SCROLL REVEAL (Animasi saat Scroll) ---
        function setupScrollReveal() {
            const reveals = document.querySelectorAll(".reveal");
            
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add("active");
                        // Hentikan pengamatan setelah elemen muncul
                        observer.unobserve(entry.target); 
                    }
                });
            }, {
                root: null,
                rootMargin: '0px',
                threshold: 0.1 
            });

            if (!mainContent.classList.contains('hidden')) {
                 reveals.forEach(el => observer.observe(el));
                 // Ganti ikon lucide setelah konten dimuat
                 lucide.createIcons();
            }
        }

        // --- FUNGSI KONTROL MUSIK ---
        function setupMusicControl() {
            audio.src = AUDIO_LINK;
            audio.load(); 
            audio.muted = true; 
            audio.volume = 0.6; 

            // Tombol Kontrol Mute/Unmute Manual
            musicControlBtn.addEventListener('click', () => {
                audio.muted = !audio.muted;
                isPlaying = !audio.muted;
                setMusicIcon(!audio.muted);

                if (!audio.muted && audio.paused) {
                     audio.play().catch(e => console.error("Play manual failed:", e));
                } else if (audio.muted) {
                    audio.pause();
                }
            });

            // Tombol Buka Undangan (Interaksi Pertama)
            openBtn.addEventListener('click', () => {
                // 1. Bersihkan parameter URL
                const url = new URL(window.location.href);
                url.searchParams.delete('to');
                window.history.replaceState({}, document.title, url.toString());

                // 2. Tampilkan konten utama
                mainContent.classList.remove('hidden');
                heroSection.classList.add('h-40'); // Mengecilkan hero section
                document.querySelector('#hero-section > div').classList.remove('p-8', 'md:p-12');
                document.querySelector('#hero-section > div').classList.add('p-4');
                document.getElementById('open-invitation-btn').classList.add('hidden'); // Sembunyikan tombol

                // 3. Putar musik (Dipicu oleh interaksi user)
                audio.muted = false;
                audio.play().then(() => {
                    isPlaying = true;
                    setMusicIcon(true);
                }).catch(e => {
                    console.warn("Autoplay gagal (browser policy). User harus menekan ikon musik.", e);
                    isPlaying = false;
                    setMusicIcon(false); 
                });
                
                // 4. Mulai Scroll Reveal dan gulir ke bagian pertama
                setupScrollReveal();
                document.getElementById('quote-section').scrollIntoView({ behavior: 'smooth' });
            }, { once: true });
        }
        
        // --- FUNGSI COPY TO CLIPBOARD ---
        function setupCopyGift() {
            const copyBtn = document.getElementById('copy-btn');
            const accountNumber = document.getElementById('account-number').textContent.trim();
            const copyMessage = document.getElementById('copy-message');

            copyBtn.addEventListener('click', () => {
                try {
                    // Fallback method for iFrame environment
                    const tempInput = document.createElement('textarea');
                    tempInput.value = accountNumber;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);

                    copyMessage.textContent = 'Berhasil disalin: ' + accountNumber;
                    copyMessage.classList.remove('hidden');
                    copyMessage.classList.add('text-green-300');
                    setTimeout(() => copyMessage.classList.add('hidden'), 3000);
                } catch (err) {
                    console.error('Gagal menyalin:', err);
                    copyMessage.textContent = 'Gagal menyalin, mohon salin manual.';
                    copyMessage.classList.remove('hidden');
                    copyMessage.classList.add('text-red-300');
                    setTimeout(() => copyMessage.classList.add('hidden'), 3000);
                }
            });
        }
        
        // --- FIRESTORE LOGIC ---

        window.setupFirestoreListeners = function() {
            // Guard clause: Pastikan Firebase terinisialisasi
            if (!window.db || !window.userId) {
                console.warn("Firestore/Auth not fully initialized. Skipping listeners setup.");
                return; 
            }

            // 1. Setup Ucapan Listener (Public Read)
            const ucapanListEl = document.getElementById('ucapan-list');
            const ucapanQuery = window.firestore.query(window.firestore.collection(window.db, window.COLLECTIONS.UCAPAN));

            window.firestore.onSnapshot(ucapanQuery, (snapshot) => {
                ucapanListEl.innerHTML = '';
                const messages = [];

                snapshot.forEach(doc => {
                    messages.push({ id: doc.id, ...doc.data() });
                });
                
                // Urutkan berdasarkan waktu (terbaru di atas)
                messages.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

                if (messages.length === 0) {
                    ucapanListEl.innerHTML = '<p class="text-center text-sm text-gray-500">Belum ada ucapan. Jadilah yang pertama!</p>';
                    return;
                }

                messages.forEach(msg => {
                    const time = msg.timestamp ? new Date(msg.timestamp.seconds * 1000).toLocaleDateString('id-ID') : 'Baru saja';
                    const item = document.createElement('div');
                    item.className = 'p-3 bg-ivory-bg rounded-lg border-l-4 border-gold-accent shadow-sm';
                    item.innerHTML = `
                        <p class="font-bold text-navy-light">${msg.nama}</p>
                        <p class="text-sm text-gray-700 mt-1">${msg.ucapan}</p>
                        <p class="text-xs text-gray-400 mt-2 text-right">(${time})</p>
                    `;
                    ucapanListEl.appendChild(item);
                });
            }, (error) => {
                console.error("Error fetching ucapans: ", error);
                ucapanListEl.innerHTML = '<p class="text-center text-sm text-red-500">Gagal memuat ucapan. Silakan coba refresh.</p>';
            });

            // 2. Setup RSVP Form Submission
            const rsvpForm = document.getElementById('rsvp-form');
            rsvpForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const nama = document.getElementById('rsvp-nama').value;
                const hadir = document.getElementById('rsvp-hadir').value;
                const rsvpMessageEl = document.getElementById('rsvp-message');

                try {
                    await window.firestore.addDoc(window.firestore.collection(window.db, window.COLLECTIONS.RSVP), {
                        userId: window.userId,
                        nama: nama,
                        status_kehadiran: hadir,
                        timestamp: window.serverTimestamp(),
                    });

                    let messageText = hadir === 'hadir' 
                        ? `Terima kasih, ${nama}! Konfirmasi kehadiran Anda telah kami terima.`
                        : `Terima kasih, ${nama}. Kami menghargai konfirmasi Anda. Doa restu Anda sudah cukup bagi kami.`;

                    let messageClass = hadir === 'hadir' 
                        ? 'bg-green-100 text-green-700 border-green-300'
                        : 'bg-yellow-100 text-yellow-700 border-yellow-300';
                        
                    displayMessage(rsvpMessageEl, messageText, messageClass);
                    rsvpForm.reset();
                    // Optional: Disable the form after submission
                    // rsvpForm.querySelector('button').disabled = true;

                } catch (error) {
                    console.error("Error submitting RSVP: ", error);
                    displayMessage(rsvpMessageEl, "Gagal menyimpan konfirmasi. Mohon coba lagi.", 'bg-red-100 text-red-700 border-red-300');
                }
            });

            // 3. Setup Ucapan Form Submission
            const ucapanForm = document.getElementById('ucapan-form');
            ucapanForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const nama = document.getElementById('ucapan-nama').value;
                const ucapan = document.getElementById('ucapan-text').value;
                const ucapanMessageEl = document.getElementById('ucapan-message');
                
                try {
                    await window.firestore.addDoc(window.firestore.collection(window.db, window.COLLECTIONS.UCAPAN), {
                        userId: window.userId,
                        nama: nama,
                        ucapan: ucapan,
                        timestamp: window.serverTimestamp(),
                    });

                    displayMessage(ucapanMessageEl, 'Doa dan ucapan Anda berhasil dikirimkan. Terima kasih!', 'bg-green-100 text-green-700 border-green-300');
                    ucapanForm.reset();
                } catch (error) {
                    console.error("Error submitting Ucapan: ", error);
                    displayMessage(ucapanMessageEl, "Gagal mengirimkan ucapan. Mohon coba lagi.", 'bg-red-100 text-red-700 border-red-300');
                }
            });
        };
        
        // --- PARSING URL (Menangkap Nama Tamu) ---
        function parseGuestName() {
            const urlParams = new URLSearchParams(window.location.search);
            let guestName = urlParams.get('to');
            
            // Mengganti underscore/plus dengan spasi
            if (guestName) {
                guestName = guestName.replace(/[\+_]/g, ' ');
                document.getElementById('guest-name').textContent = guestName;
            } else {
                document.getElementById('guest-name').textContent = 'Tamu Undangan';
            }
        }


        // --- INICIALISASI APLIKASI ---
        window.onload = function() {
            // 1. Parsing Nama Tamu dari URL (?to=Nama)
            parseGuestName();
            
            // 2. Setup Hero Image
            setupHeroImage();

            // 3. Start Countdown 
            updateCountdown();
            window.countdownInterval = setInterval(updateCountdown, 1000); 
            
            // 4. Setup Interaksi dan Kontrol Musik
            setupMusicControl();
            setupCopyGift();

            // Tampilkan ikon musik awal (mute)
            setMusicIcon(false);

            // Inisialisasi awal Scroll Reveal hanya untuk Hero Section
            document.querySelector('#hero-section > div').classList.add('active');
        };

    </script>
</body>
</html>